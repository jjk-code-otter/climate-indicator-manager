<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Climind documentation &mdash; Climind 1.2 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="#" class="icon icon-home"> Climind
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">Climind documentation</a></li>
<li><a class="reference internal" href="#other-pages">Other pages</a></li>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#set-up">Set up</a></li>
<li><a class="reference internal" href="#downloading-data">Downloading data</a></li>
<li><a class="reference internal" href="#processing-the-data">Processing the data</a></li>
<li><a class="reference internal" href="#building-the-website">Building the website</a></li>
<li><a class="reference internal" href="#diverse-other-scripts">Diverse other scripts</a></li>
<li><a class="reference internal" href="#adding-data-sets-for-an-existing-variable">Adding data sets for an existing variable</a></li>
<li><a class="reference internal" href="#adding-a-new-variable">Adding a new variable</a></li>
<li><a class="reference internal" href="#making-a-new-dashboard">Making a new dashboard</a></li>
<li><a class="reference internal" href="#calculating-regional-averages">Calculating regional averages</a></li>
<li><a class="reference internal" href="#descriptive-text">Descriptive text</a></li>
</ul>
</div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">Climind</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="#" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">Climind documentation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="module-climind">
<span id="climind-documentation"></span><h1>Climind documentation<a class="headerlink" href="#module-climind" title="Permalink to this heading"></a></h1>
<div class="toctree-wrapper compound">
</div>
</div>
<div class="section" id="other-pages">
<h1>Other pages<a class="headerlink" href="#other-pages" title="Permalink to this heading"></a></h1>
<ul class="simple">
<li><p><a class="reference internal" href="user_guide.html#userguide"><span class="std std-ref">User guide</span></a></p></li>
<li><p><a class="reference internal" href="how_to.html#howto"><span class="std std-ref">Some simple examples</span></a></p></li>
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></p></li>
<li><p><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></p></li>
</ul>
<p>A lightweight package for managing, downloading and processing climate data for use in calculating and presenting
climate indicators.</p>
<p>It is built on a collection of metadata files which describe the location and content of individual data collections and
data sets from those collections. For example, a <em>collection</em> might be something like “HadCRUT” and an individual
<em>dataset</em> would be the file containing the monthly global mean temperatures calculated by the providers of “HadCRUT”.</p>
<p>The current functionality includes tools to download, read and undertake simple processing of monthly and annual
timeseries and grids. Currently, simple processing includes:</p>
<ol class="arabic simple">
<li><p>changing the baseline of the data,</p></li>
<li><p>aggregating monthly data into annual data and</p></li>
<li><p>calculating running means of the data.</p></li>
</ol>
<p>Various statistics can also be calculated from the timeseries, including rankings for particular years and years
associated with particular rankings.</p>
<p>Each step in processing is logged and added to the metadata for the dataset so that processing steps can be traced
and reproduced.</p>
</div>
<div class="section" id="installation">
<h1>Installation<a class="headerlink" href="#installation" title="Permalink to this heading"></a></h1>
<p>Download the code from the repository using your preferred method.</p>
<p>An environment.yml file contains the details of the necessary conda environment. To
setup the environment run</p>
<p><cite>conda env create -f &lt;path_to_yaml_file&gt;</cite></p>
<p>The environment (called <cite>wmo</cite>) can then be activated by typing</p>
<p><cite>conda activate wmo</cite></p>
<p>Navigate to the root directory of the repository and type</p>
<p><cite>pip install .</cite></p>
<p>This should install the package.</p>
<p>You will need to download a couple of different files if you want to calculate regional
averages from gridded data. These include</p>
<ul class="simple">
<li><p>WMO Shape files for the WMO Regional Associations and Africa subregions.
I don’t know of an online source for these so you will have to ask a friendly person
at the WMO.</p></li>
<li><p>The Natural Earth country files <a class="reference external" href="https://naciscdn.org/naturalearth/10m/cultural/ne_10m_admin_0_countries.zip">https://naciscdn.org/naturalearth/10m/cultural/ne_10m_admin_0_countries.zip</a></p></li>
</ul>
</div>
<div class="section" id="set-up">
<h1>Set up<a class="headerlink" href="#set-up" title="Permalink to this heading"></a></h1>
<p>The managed data will be stored in a directory specified by the environment variable DATADIR. This is easy to set in
linux. In windows, do the following:</p>
<ol class="arabic simple">
<li><p>right-click on the Windows icon (bottom left of the screen usually) and select “System”</p></li>
<li><p>Click on “Advanced system settings”</p></li>
<li><p>Click on “Environment Variables…”</p></li>
<li><p>Under “User variables for Username” click “New…”</p></li>
<li><p>For “Variable name” type DATADIR</p></li>
<li><p>For “Variable value” type the pathname for the directory you want the data to go in.</p></li>
</ol>
<p>In addition, if you want to download JRA-55 data from UCAR, CMEMS data or data from the NASA PODAAC, you will need a
valid username and password combo for each of these services. These values should be stored in a file called .env in
the <cite>fetchers</cite> directory of the repository. It should contain two lines for each of the data services:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UCAR_EMAIL</span><span class="o">=</span><span class="n">youremail</span><span class="nd">@domain</span><span class="o">.</span><span class="n">com</span>
<span class="n">UCAR_PSWD</span><span class="o">=</span><span class="n">yourpasswordhere</span>
<span class="n">PODAAC_PSWD</span><span class="o">=</span><span class="n">anotherpasswordhere</span>
<span class="n">PODAAC_USER</span><span class="o">=</span><span class="n">anotherusernamehere</span>
<span class="n">CMEMS_USER</span><span class="o">=</span><span class="n">athirdusername</span>
<span class="n">CMEMS_PSWD</span><span class="o">=</span><span class="n">yetanotherpassword</span>
</pre></div>
</div>
<p>All three of these services are free to register, but you will have to set up the credentials online.</p>
</div>
<div class="section" id="downloading-data">
<h1>Downloading data<a class="headerlink" href="#downloading-data" title="Permalink to this heading"></a></h1>
<p>The first thing to do is to download the data. There are two main scripts for downloading data in the scripts
directory. <cite>get_timeseries.py</cite> will download the data which are in the form of time series. <cite>get_grids.py</cite> will download
the gridded data.</p>
<p>The volume of gridded data is considerably larger than the volume of time series data. For some datasets, the whole
gridded dataset is downloaded each time this is run, but for the reanalyses the full dataset is only downloaded once
with subsequent runs of the get_grids.py script only downloading months that have not already been downloaded. The
gridded data are used to calculate custom area averages (such as the WMO Regional Association averages) and for
plotting maps of the data. The key global indicators are all time series.</p>
<p>Some datasets are not available online (the JRA-55 global mean temperature for example) so you will have to obtain
these from somewhere else or remove them from the processing. Any extra files such as these should be
copied into the <cite>$DATADIR/ManagedData/Data/</cite> directory in an appropriately named subdirectory that corresponds
to the unique name given to the data set. This can be found in the metadata file for the data set (see below).</p>
</div>
<div class="section" id="processing-the-data">
<h1>Processing the data<a class="headerlink" href="#processing-the-data" title="Permalink to this heading"></a></h1>
<p>The gridded data need to be pre-processed by running:</p>
<p><cite>python regrid_grids.py</cite></p>
<p>which calculates annual average grids on a consistent 5-degree latitude longitude grid for all the gridded data sets.</p>
<p>In order to generate area averages from the gridded data for specified sub regions, you will need to navigate to the
scripts directory and run:</p>
<p><cite>python make_new_regions.py</cite> (you only need to run this the first time to generate the shape files for subregion)</p>
<p><cite>python calculate_wmo_ra_averages.py</cite></p>
<p>This reads in each of the data sets, regrids it to a standard resolution and then calculates the area averages for the
six WMO Regional Association areas and for the six African sub regions. It can take a while to run because it has to
load and process a lot of reanalysis data.</p>
</div>
<div class="section" id="building-the-website">
<h1>Building the website<a class="headerlink" href="#building-the-website" title="Permalink to this heading"></a></h1>
<p>To build the websites, navigate to the scripts directory and run</p>
<p><cite>python build_dashboard.py</cite></p>
<p>This builds all the webpages, produces the figures for each web page and prepares the formatted data sets. These are
written to the <cite>DATADIR/ManagedData</cite> directory with one directory created for each dashboard. Currently the code is
set up to generate four dashboards: key indicators to 2021, key indicators to 2022, ocean indicators,
and regional indicators to 2022.</p>
<p>To display a dashboard on the web, the files in the appropriate directory will need to be copied to an appropriate
web server.</p>
</div>
<div class="section" id="diverse-other-scripts">
<h1>Diverse other scripts<a class="headerlink" href="#diverse-other-scripts" title="Permalink to this heading"></a></h1>
<p>As well as these main scripts, described above, there are others which perform the following tasks:</p>
<ul class="simple">
<li><p><cite>annual_global_temperature_stats.py</cite> which generates some annual plots and statistics</p></li>
<li><p><cite>arctic_sea_ice_plot.py</cite> which generates some sea ice plots</p></li>
<li><p><cite>change_per_month_plots.py</cite> which generates some plots based on monthly global mean temperature as well as some stats.</p></li>
<li><p><cite>five_year_global_temperature_stats.py</cite> which generates some plots and stats based on 5-year running averages of
global temperature</p></li>
<li><p><cite>marine_heatwave_plot.py</cite> which generates a plot of marine heatwave and cold spell occurrence.</p></li>
<li><p><cite>plot_monthly_indicators.py</cite> which generates a set of plots for a range of indicators (not all monthly).</p></li>
<li><p><cite>plot_monthly_maps.py</cite> which allows for the plotting of monthly temperature anomaly maps.</p></li>
<li><p><cite>ten_year_global_temperature_stats.py</cite> which generates some plots and stats based on 10-year running averages of
global temperature</p></li>
</ul>
</div>
<div class="section" id="adding-data-sets-for-an-existing-variable">
<h1>Adding data sets for an existing variable<a class="headerlink" href="#adding-data-sets-for-an-existing-variable" title="Permalink to this heading"></a></h1>
<p>To add a dataset for an existing variable, you need to
* create a new collection file in the <cite>metadata</cite> folder
* write a reader function in the <cite>readers</cite> directory. This should correspond to the “reader” entry in the collection metadata.
* write a fetcher function in the <cite>fetchers</cite> directory. This should correspond to the “reader” entry in the collection metadata. This is only necessary if the file(s) can’t be downloaded as a simple http(s) or ftp(s) request. For example, some datasets do not have a static URL, or there are a large number of files, or there is an API for accessing the data.</p>
<p>The form of these files should be clear from the other files and function in the respective
directories, or by perusal of the schemas in the <cite>data_manager</cite> directory. An example metadata file looks like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;HadCRUT5&quot;</span><span class="p">,</span>
  <span class="s2">&quot;display_name&quot;</span><span class="p">:</span> <span class="s2">&quot;HadCRUT5&quot;</span><span class="p">,</span>
  <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;5.0.1.0&quot;</span><span class="p">,</span>
  <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="s2">&quot;tas&quot;</span><span class="p">,</span>
  <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;degC&quot;</span><span class="p">,</span>
  <span class="s2">&quot;citation&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Morice, C.P., J.J. Kennedy, N.A. Rayner, J.P. Winn, E. Hogan, R.E. Killick, R.J.H. Dunn, T.J. Osborn, P.D. Jones and I.R. Simpson (in press) An updated assessment of near-surface temperature change from 1850: the HadCRUT5 dataset. Journal of Geophysical Research (Atmospheres) doi:10.1029/2019JD032361&quot;</span><span class="p">],</span>
  <span class="s2">&quot;data_citation&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">],</span>
  <span class="s2">&quot;acknowledgement&quot;</span><span class="p">:</span> <span class="s2">&quot;HadCRUT.VVVV data were obtained from http://www.metoffice.gov.uk/hadobs/hadcrut5 on AAAA and are © British Crown Copyright, Met Office YYYY, provided under an Open Government License, http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/&quot;</span><span class="p">,</span>
  <span class="s2">&quot;colour&quot;</span><span class="p">:</span> <span class="s2">&quot;dimgrey&quot;</span><span class="p">,</span>
  <span class="s2">&quot;zpos&quot;</span><span class="p">:</span> <span class="mi">99</span><span class="p">,</span>
  <span class="s2">&quot;datasets&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;https://www.metoffice.gov.uk/hadobs/hadcrut5/data/current/analysis/HadCRUT.5.0.1.0.analysis.anomalies.ensemble_mean.nc&quot;</span><span class="p">],</span>
      <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;HadCRUT.5.0.1.0.analysis.anomalies.ensemble_mean.nc&quot;</span><span class="p">],</span>
      <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;gridded&quot;</span><span class="p">,</span>
      <span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Near surface temperature&quot;</span><span class="p">,</span>
      <span class="s2">&quot;time_resolution&quot;</span><span class="p">:</span> <span class="s2">&quot;monthly&quot;</span><span class="p">,</span>
      <span class="s2">&quot;space_resolution&quot;</span><span class="p">:</span> <span class="mf">5.0</span><span class="p">,</span>
      <span class="s2">&quot;climatology_start&quot;</span><span class="p">:</span> <span class="mi">1961</span><span class="p">,</span>
      <span class="s2">&quot;climatology_end&quot;</span><span class="p">:</span> <span class="mi">1990</span><span class="p">,</span>
      <span class="s2">&quot;actual&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
      <span class="s2">&quot;derived&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
      <span class="s2">&quot;history&quot;</span><span class="p">:</span> <span class="p">[],</span>
      <span class="s2">&quot;reader&quot;</span><span class="p">:</span> <span class="s2">&quot;reader_hadcrut_ts&quot;</span><span class="p">,</span>
      <span class="s2">&quot;fetcher&quot;</span><span class="p">:</span> <span class="s2">&quot;fetcher_standard_url&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The metadata describes a collection of data, in this case “HadCRUT5”. HadCRUT5 consists of a number of data sets (only one is listed here) which are listed
under the “datasets” entry. It’s important to populate as much of the metadata file as possible, as this links the outputs of the dashboard back to the initial
inputs and maintains transparency of the system. The “reader” and “fetcher” specify functions for reading the data and downloading the data which are found in the ‘readers’ and ‘fetchers’ directories.</p>
<p>More complicated examples can be found in the repository.</p>
<ul class="simple">
<li><p><cite>name</cite> - this is a <strong>unique</strong> name for this particular collection</p></li>
<li><p><cite>display_name</cite> - name used to label datasets in this collection in figure legends, captions and text.</p></li>
<li><p><cite>version</cite> - latest version number for the data set</p></li>
<li><p><cite>variable</cite> - variable name. <cite>tas</cite> is global surface temperature.</p></li>
<li><p><cite>units</cite> - units used for this variable.</p></li>
<li><p><cite>citation</cite> - a list of citations for papers describing the data set.</p></li>
<li><p><cite>data_citation</cite> - a list of data citations for the data itself (if such exists).</p></li>
<li><p><cite>acknowledgement</cite> - many dataset providers request a particular acknowledgement when the data are used.</p></li>
<li><p><cite>colour</cite> - python colour name or hexadecimal RGB triple, used to represent data from this collection in line graphs</p></li>
<li><p><cite>zpos</cite> - used to force ordering of lines in plots. Lines with higher zpos values will be drawn over lines with lower zpos values.</p></li>
</ul>
<p>The dataset section consists of a lits of dataset metadata:</p>
<ul class="simple">
<li><p><cite>url</cite> - a list of URLs for the files.</p></li>
<li><p><cite>filename</cite> - a list of the filenames which will be associated with the data set. For example, NSIDC Arctic ice extent has 12 files, one for each month of the year.</p></li>
<li><p><cite>type</cite> - type of the data, either <cite>timeseries</cite> or <cite>gridded</cite>.</p></li>
<li><p><cite>long_name</cite> - long descriptive name used in figure captions and other automatically generated text.</p></li>
<li><p><cite>time_resolution</cite> - either <cite>monthly</cite> or <cite>annual</cite></p></li>
<li><p><cite>space_resolution</cite> - for <cite>gridded</cite> data sets this specifies the grid resolution in degrees. Set to 999 for time series data.</p></li>
<li><p><cite>climatology_start</cite> - first year of the climatology period of the data in the data set.</p></li>
<li><p><cite>climatology_end</cite> - last year of the climatology period of the data in the data set.</p></li>
<li><p><cite>actual</cite> - set to True if the file contains actual values, set to False for anomalies.</p></li>
<li><p><cite>derived</cite> - set to False. During processing, this flag is set to True to indicate that the original data have been further processed within the dashboard software.</p></li>
<li><p><cite>history</cite> - a list which will hold the details of processing steps</p></li>
<li><p><cite>reader</cite> - the name of a script in the <cite>climind/readers</cite> directory which will read the data described in the dataset metadata.</p></li>
<li><p><cite>fetcher</cite> - the name of a script in the <cite>climind/fetchers</cite> direcotry which will download the data described in the dataset metadata.</p></li>
</ul>
</div>
<div class="section" id="adding-a-new-variable">
<h1>Adding a new variable<a class="headerlink" href="#adding-a-new-variable" title="Permalink to this heading"></a></h1>
<p>It is possible to add new variables. For example, there is currently no snow_cover variable.</p>
<ol class="arabic simple">
<li><p>Think of a variable name e.g. <cite>snow_cover</cite></p></li>
<li><p>Check that the variable does not already exist. You can do this by looking through the metadata files.</p></li>
<li><p>Add a new metadata file describing a collection with snow cover data in it.</p></li>
<li><p>Check that the units are in the <cite>metadata_schema.json</cite> file in <cite>climind.data_manager</cite>. This is used to validate the metadata when it is read in.</p></li>
<li><p>Add the new variable to the word document in <cite>climind/web/word_documents/key_indicators_texts.docx</cite>. Individual variables
appear towards the end of the document. The short <cite>variable</cite> name should appear in <cite>Heading1</cite> style and the text desribing it
should appear in <cite>normal</cite> style text. These short descriptions appear on the webpages in the section detailing the datasets and their processing.</p></li>
</ol>
<p>That should be sufficient.</p>
</div>
<div class="section" id="making-a-new-dashboard">
<h1>Making a new dashboard<a class="headerlink" href="#making-a-new-dashboard" title="Permalink to this heading"></a></h1>
<p>A dashboard is created using a dashboard metadata file. These are located in <cite>climind/web/dashboard_metadata</cite>. Each dashboard is split into Pages, which
each correspond to an html webpage. Each Page consists of a set of Cards and Paragraphs (the capital letters indicate these are represented as classes
in the underlying code). For examples, please see the <cite>climind/web/dashboard_metadata</cite> directory.</p>
<p>A dashboard metadata file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Key Indicators&quot;</span><span class="p">,</span>
  <span class="s2">&quot;pages&quot;</span><span class="p">:</span> <span class="p">[</span> <span class="o">...</span> <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <cite>pages</cite> entry consists of a list of Pages which look something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;dashboard&quot;</span><span class="p">,</span>
  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Key Climate Indicators&quot;</span><span class="p">,</span>
  <span class="s2">&quot;template&quot;</span><span class="p">:</span> <span class="s2">&quot;front_page&quot;</span><span class="p">,</span>
  <span class="s2">&quot;cards&quot;</span><span class="p">:</span> <span class="p">[</span> <span class="o">...</span> <span class="p">],</span>
  <span class="s2">&quot;paragraphs&quot;</span><span class="p">:</span> <span class="p">[</span> <span class="o">...</span> <span class="p">]</span>
<span class="p">},</span>
</pre></div>
</div>
<p>The <cite>template</cite> can be either a <cite>front_page</cite> or a <cite>topic_page</cite>. The front page is intended to be a clean landing page
for users. More information is provided on topic pages, including e.g. figure captions.</p>
<p>The <cite>cards</cite> entry is made up of one or more cards and the <cite>paragraphs</cite> entry of one or more paragraphs.</p>
<p>A Card, contains an image, links to the image in other format, links to the data in a standard format and a link to another Page.
The metadata entries look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;link_to&quot;</span><span class="p">:</span> <span class="s2">&quot;global_mean_temperature&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Global temperature&quot;</span><span class="p">,</span>
  <span class="s2">&quot;selecting&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;timeseries&quot;</span><span class="p">,</span> <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="s2">&quot;tas&quot;</span><span class="p">,</span> <span class="s2">&quot;time_resolution&quot;</span><span class="p">:</span> <span class="s2">&quot;monthly&quot;</span><span class="p">},</span>
  <span class="s2">&quot;processing&quot;</span><span class="p">:</span>  <span class="p">[{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;rebaseline&quot;</span><span class="p">,</span> <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1981</span><span class="p">,</span> <span class="mi">2010</span><span class="p">]},</span>
                  <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;make_annual&quot;</span><span class="p">,</span> <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">[]},</span>
                  <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;select_year_range&quot;</span><span class="p">,</span> <span class="s2">&quot;args&quot;</span><span class="p">:</span>  <span class="p">[</span><span class="mi">1850</span><span class="p">,</span><span class="mi">2021</span><span class="p">]},</span>
                  <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;add_offset&quot;</span><span class="p">,</span> <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.69</span><span class="p">]},</span>
                  <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;manually_set_baseline&quot;</span><span class="p">,</span> <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1850</span><span class="p">,</span> <span class="mi">1900</span><span class="p">]}],</span>
  <span class="s2">&quot;plotting&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;function&quot;</span><span class="p">:</span> <span class="s2">&quot;neat_plot&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Global mean temperature&quot;</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The entries say which other page the Card can <cite>link_to</cite> using the <cite>id</cite> of a page and what the <cite>title</cite> of the page should be.
<cite>selecting</cite> specifies which subset of data you want to plot, with entries here corresponding to entries in the collection metadata.
<cite>processing</cite> details the processing steps to be applied to each of the selected data sets, with <cite>method</cite> corresponding to a method in the
relevant data type (at the moment <cite>TimeSeriesMonthly</cite> or <cite>TimeSeriesAnnual</cite>) and <cite>args</cite> being the arguments to pass to the method.
<cite>plotting</cite> specifies the function to the be used to plot the data (<cite>neat_plot</cite> being the standard type for annual plots) and can also
be used to pass additional arguments to the plot function. Plotting functions are found in <cite>climind/plotters/plot_types.py</cite></p>
<p>A Paragraph is similar to a Card, except the output is a paragraph of text. An entry looks something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;selecting&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;timeseries&quot;</span><span class="p">,</span> <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="s2">&quot;tas&quot;</span><span class="p">,</span> <span class="s2">&quot;time_resolution&quot;</span><span class="p">:</span> <span class="s2">&quot;monthly&quot;</span><span class="p">},</span>
  <span class="s2">&quot;processing&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;rebaseline&quot;</span><span class="p">,</span> <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1981</span><span class="p">,</span> <span class="mi">2010</span><span class="p">]},</span>
                  <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;make_annual&quot;</span><span class="p">,</span> <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">[]},</span>
                  <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;select_year_range&quot;</span><span class="p">,</span> <span class="s2">&quot;args&quot;</span><span class="p">:</span>  <span class="p">[</span><span class="mi">1850</span><span class="p">,</span><span class="mi">2021</span><span class="p">]},</span>
                  <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;add_offset&quot;</span><span class="p">,</span> <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.69</span><span class="p">]},</span>
                  <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;manually_set_baseline&quot;</span><span class="p">,</span> <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1850</span><span class="p">,</span> <span class="mi">1900</span><span class="p">]}],</span>
  <span class="s2">&quot;writing&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;function&quot;</span><span class="p">:</span> <span class="s2">&quot;anomaly_and_rank&quot;</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><cite>selecting</cite> and <cite>processing</cite> behave as they did for Cards, <cite>writing</cite> is similar to <cite>plotting</cite> and produces the main output. Paragraph writers
are found in <cite>climind/stats/paragraphs.py</cite>.</p>
<p>Once the dashboard metadata is complete, add an entry to <cite>climind/scripts/build_dashboard.py</cite> along the lines of:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">json_file</span> <span class="o">=</span> <span class="n">ROOT_DIR</span> <span class="o">/</span> <span class="s1">&#39;climind&#39;</span> <span class="o">/</span> <span class="s1">&#39;web&#39;</span> <span class="o">/</span> <span class="s1">&#39;dashboard_metadata&#39;</span> <span class="o">/</span> <span class="s1">&#39;new_dashboard.json&#39;</span>
<span class="n">dash</span> <span class="o">=</span> <span class="n">Dashboard</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">json_file</span><span class="p">,</span> <span class="n">METADATA_DIR</span><span class="p">)</span>

<span class="n">dash_dir</span> <span class="o">=</span> <span class="n">DATA_DIR</span> <span class="o">/</span> <span class="s1">&#39;ManagedData&#39;</span> <span class="o">/</span> <span class="s1">&#39;NewDashboard&#39;</span>
<span class="n">dash_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dash</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">dash_dir</span><span class="p">))</span>
</pre></div>
</div>
<p>The <cite>json_file</cite> is the dashboard metadata file. The <cite>dash_dir</cite> is the directory where you want to build the dashboard. <cite>dash.build()</cite> builds the dashboard.</p>
</div>
<div class="section" id="calculating-regional-averages">
<h1>Calculating regional averages<a class="headerlink" href="#calculating-regional-averages" title="Permalink to this heading"></a></h1>
<p>Regional averages are calculated using <cite>calculate_wmo_ra_averages.py</cite>. This generates a large number of files containing regional averages based
on the gridded temperature data sets. This takes some time to run.</p>
<p><cite>python calculate_wmo_ra_averages.py</cite></p>
</div>
<div class="section" id="descriptive-text">
<h1>Descriptive text<a class="headerlink" href="#descriptive-text" title="Permalink to this heading"></a></h1>
<p>In <cite>climind/web/word_documents</cite> there is a Word document that is used to generate text for the
web pages. The document is called <cite>key_indicators_texts.docx</cite>. This has descriptive text for
each page on the key indicators dashboard as well as descriptions for each of the variables.</p>
<p>when changes are made to the word document, these will need to be converted to html by navigating to <cite>climind/web</cite> and running</p>
<p><cite>python extract_from_word.py</cite></p>
<p>The word document is structured using the inbuilt “styles”.</p>
<p>Each page in the dashboard can have an Introduction text. To do this, add a new <cite>Heading1</cite> style heading in the document
with text that matches the id of a page in the dashboard. You can then write <cite>normal</cite> style text beneath it.
Subheadings can be added using <cite>Heading2</cite> style text followed by <cite>normal</cite> text. For example, the “What the IPCC says”
sections. Hyperlinks can be added and these will be rendered in the webpages.</p>
<p>Individual variable descriptions can also be added here. The method is similar. A Heading1 style heading which matches
the <cite>variable</cite> name from the metadata file, followed by <cite>normal</cite> style text. Sub-headings do not work for variables. These
are intended to be short descriptions of the variables.</p>
</div>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, John Kennedy.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>