

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>climind.data_types.timeseries &mdash; Climind 1.3 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=c55cb9cb"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            Climind
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"></div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Climind</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">climind.data_types.timeseries</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for climind.data_types.timeseries</h1><div class="highlight"><pre>
<span></span><span class="c1">#  Climate indicator manager - a package for managing and building climate indicator dashboards.</span>
<span class="c1">#  Copyright (c) 2022 John Kennedy</span>
<span class="c1">#</span>
<span class="c1">#  This program is free software: you can redistribute it and/or modify</span>
<span class="c1">#  it under the terms of the GNU General Public License as published by</span>
<span class="c1">#  the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1">#  (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1">#  This program is distributed in the hope that it will be useful,</span>
<span class="c1">#  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1">#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1">#  GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1">#  You should have received a copy of the GNU General Public License</span>
<span class="c1">#  along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Union</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pkg_resources</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">reduce</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">jinja2</span><span class="w"> </span><span class="kn">import</span> <span class="n">Environment</span><span class="p">,</span> <span class="n">FileSystemLoader</span><span class="p">,</span> <span class="n">select_autoescape</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cftime</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cf</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">climind.data_manager.metadata</span><span class="w"> </span><span class="kn">import</span> <span class="n">CombinedMetadata</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">climind.definitions</span><span class="w"> </span><span class="kn">import</span> <span class="n">ROOT_DIR</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.nonparametric.smoothers_lowess</span><span class="w"> </span><span class="kn">import</span> <span class="n">lowess</span>


<div class="viewcode-block" id="log_activity">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.log_activity">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">log_activity</span><span class="p">(</span><span class="n">in_function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Decorator function to log name of function run and with which arguments.</span>
<span class="sd">    This aims to provide some traceability in the output.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    in_function: Callable</span>
<span class="sd">        The function to be decorated</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Callable</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running: </span><span class="si">{</span><span class="n">in_function</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">TimeSeries</span><span class="p">):</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;on </span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;With arguments:&quot;</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;And keyword arguments:&quot;</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">in_function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapper</span></div>



<div class="viewcode-block" id="TimeSeries">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeries">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TimeSeries</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A base class for representing time series data sets. Note that this class should not generally be used</span>
<span class="sd">    and only its subclasses :class:`TimeSeriesMonthly`, :class:`TimeSeriesAnnual` and :class:`TimeSeriesIrregular`</span>
<span class="sd">    should be used. This class contains shared functionality from these classes but does not work on its own.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">CombinedMetadata</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;history&quot;</span><span class="p">:</span> <span class="p">[]}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span>

<div class="viewcode-block" id="TimeSeries.select_year_range">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeries.select_year_range">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">select_year_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end_year</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select consecutive years in the specified range and throw away the rest.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        start_year: int</span>
<span class="sd">            First year in the selected range</span>
<span class="sd">        end_year: int</span>
<span class="sd">            Final year in the selected range</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TimeSeries</span>
<span class="sd">            Return time series which only contains years in the specified range</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start_year</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end_year</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Selected years within the range </span><span class="si">{</span><span class="n">start_year</span><span class="si">}</span><span class="s1"> to </span><span class="si">{</span><span class="n">end_year</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="TimeSeries.manually_set_baseline">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeries.manually_set_baseline">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">manually_set_baseline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">baseline_start_year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">baseline_end_year</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Manually set baseline. This changes the baseline in the metadata, but does not change the</span>
<span class="sd">        data themselves.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        baseline_start_year: int</span>
<span class="sd">            Start of baseline period</span>
<span class="sd">        baseline_end_year: int</span>
<span class="sd">            End of baseline period</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># update attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;climatology_start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">baseline_start_year</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;climatology_end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">baseline_end_year</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;actual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Manually changed baseline to </span><span class="si">{</span><span class="n">baseline_start_year</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">baseline_end_year</span><span class="si">}</span><span class="s1">. &#39;</span>
                            <span class="sa">f</span><span class="s1">&#39;Note that data values remain unchanged.&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeSeries.get_first_and_last_year">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeries.get_first_and_last_year">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_first_and_last_year</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the first and last year in the series</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Tuple[int, int]</span>
<span class="sd">            first and last year</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">first_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">last_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">first_year</span><span class="p">,</span> <span class="n">last_year</span></div>


<div class="viewcode-block" id="TimeSeries.update_history">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeries.update_history">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the history metadata</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        message : str</span>
<span class="sd">            Message to be added to history</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeSeries.add_offset">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeries.add_offset">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add an offset to the data set.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        offset : float</span>
<span class="sd">            offset to be added to all values in the data set.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;derived&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Added offset of </span><span class="si">{</span><span class="n">offset</span><span class="si">}</span><span class="s1"> to all data values.&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeSeries.write_generic_csv">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeries.write_generic_csv">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">write_generic_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">metadata_filename</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
                          <span class="n">monthly</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">uncertainty</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">irregular</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
                          <span class="n">columns_to_write</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write the dataset out into csv format</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename: Path</span>
<span class="sd">            Path of the csv file to which the data will be written.</span>
<span class="sd">        metadata_filename: Path</span>
<span class="sd">            Path of the json file to which the data will be written.</span>
<span class="sd">        monthly: bool</span>
<span class="sd">            Set to True for monthly data</span>
<span class="sd">        uncertainty: bool</span>
<span class="sd">            Set to True to print uncertainties</span>
<span class="sd">        irregular: bool</span>
<span class="sd">            Set to True for irregular data</span>
<span class="sd">        columns_to_write: List[str]</span>
<span class="sd">            List of the columns from the dataframe to be written to the data file</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">metadata_filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;reader&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;reader_badc_csv&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;fetcher&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;fetcher_no_url&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Wrote to file </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">write_metadata</span><span class="p">(</span><span class="n">metadata_filename</span><span class="p">)</span>

        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
        <span class="n">climind_version</span> <span class="o">=</span> <span class="n">pkg_resources</span><span class="o">.</span><span class="n">get_distribution</span><span class="p">(</span><span class="s2">&quot;climind&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">version</span>

        <span class="n">time_units</span> <span class="o">=</span> <span class="s1">&#39;days since 1800-01-01 00:00:00.0&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_dates</span><span class="p">(</span><span class="n">time_units</span><span class="p">)</span>

        <span class="c1"># populate template to make webpage</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span>
            <span class="n">loader</span><span class="o">=</span><span class="n">FileSystemLoader</span><span class="p">(</span><span class="n">ROOT_DIR</span> <span class="o">/</span> <span class="s2">&quot;climind&quot;</span> <span class="o">/</span> <span class="s2">&quot;data_types&quot;</span> <span class="o">/</span> <span class="s2">&quot;jinja_templates&quot;</span><span class="p">),</span>
            <span class="n">autoescape</span><span class="o">=</span><span class="n">select_autoescape</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="s2">&quot;badc_boilerplate.jinja2&quot;</span><span class="p">)</span>

        <span class="n">rendered</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">now</span><span class="o">=</span><span class="n">now</span><span class="p">,</span> <span class="n">climind_version</span><span class="o">=</span><span class="n">climind_version</span><span class="p">,</span>
                                   <span class="n">metadata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
                                   <span class="n">monthly</span><span class="o">=</span><span class="n">monthly</span><span class="p">,</span> <span class="n">irregular</span><span class="o">=</span><span class="n">irregular</span><span class="p">,</span>
                                   <span class="n">time_units</span><span class="o">=</span><span class="n">time_units</span><span class="p">,</span> <span class="n">uncertainty</span><span class="o">=</span><span class="n">uncertainty</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">rendered</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                   <span class="n">lineterminator</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                                   <span class="n">float_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.4f</span><span class="s1">&#39;</span><span class="p">,</span>
                                   <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                   <span class="n">columns</span><span class="o">=</span><span class="n">columns_to_write</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;end data</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeSeries.get_string_date_range">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeries.get_string_date_range">[docs]</a>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_string_date_range</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a string which specifies the date range covered by the time series</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">        &quot;&quot;&quot;</span></div>
</div>



<div class="viewcode-block" id="TimeSeriesIrregular">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesIrregular">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TimeSeriesIrregular</span><span class="p">(</span><span class="n">TimeSeries</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A :class:`TimeSeriesIrregular` combines a pandas Dataframe with a</span>
<span class="sd">    :class:`.CombinedMetadata` to bring together data and</span>
<span class="sd">    metadata in one object. It represents non-monthly, non-annual averages of data such as weekly, or</span>
<span class="sd">    5-day averages.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">years</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">months</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">days</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
                 <span class="n">metadata</span><span class="p">:</span> <span class="n">CombinedMetadata</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">uncertainty</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create :class:`TimeSeriesIrregular` object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        years: List[int]</span>
<span class="sd">            List of integers specifying the year of each data point</span>
<span class="sd">        months: List[int]</span>
<span class="sd">            List of integers specifying the month of each data point</span>
<span class="sd">        days: List[int]</span>
<span class="sd">            List of integers specifying the day of each data point</span>
<span class="sd">        data: List[float]</span>
<span class="sd">            List of floats with the data values</span>
<span class="sd">        metadata: CombinedMetadata</span>
<span class="sd">            CombinedMetadata object holding the metadata for the dataset</span>
<span class="sd">        uncertainty: List[float]</span>
<span class="sd">            List of floats with the uncertainty values for each data point</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>

        <span class="n">dico</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="n">years</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">:</span> <span class="n">months</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">:</span> <span class="n">days</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">uncertainty</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dico</span><span class="p">[</span><span class="s1">&#39;uncertainty&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uncertainty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dico</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">year</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">],</span>
                <span class="n">month</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">],</span>
                <span class="n">day</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">out_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;TimeSeriesIrregular: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">out_str</span>

<div class="viewcode-block" id="TimeSeriesIrregular.fill_daily">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesIrregular.fill_daily">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">fill_daily</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>

        <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_start_and_end_dates</span><span class="p">()</span>

        <span class="n">start_year</span> <span class="o">=</span> <span class="n">start_date</span><span class="o">.</span><span class="n">year</span>
        <span class="n">final_year</span> <span class="o">=</span> <span class="n">end_date</span><span class="o">.</span><span class="n">year</span>

        <span class="n">t_index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">start_year</span><span class="si">}</span><span class="s1">-01-01&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">final_year</span><span class="si">}</span><span class="s1">-12-31&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">))</span>

        <span class="n">df_rsmpld</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">t_index</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">df_rsmpld</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">year</span> <span class="o">=</span> <span class="n">t_index</span><span class="o">.</span><span class="n">year</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">month</span> <span class="o">=</span> <span class="n">t_index</span><span class="o">.</span><span class="n">month</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">day</span> <span class="o">=</span> <span class="n">t_index</span><span class="o">.</span><span class="n">day</span></div>


<div class="viewcode-block" id="TimeSeriesIrregular.get_climatology">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesIrregular.get_climatology">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_climatology</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">climatology_start_year</span><span class="p">,</span> <span class="n">climatology_end_year</span><span class="p">):</span>
        <span class="c1"># Calculate climatology and fill out repeating climatology to full length of series</span>
        <span class="n">df2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">climatology_start_year</span><span class="p">]</span>
        <span class="n">df2</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">climatology_end_year</span><span class="p">]</span>

        <span class="n">climatology</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">df2</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">df2</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">day</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">climatology</span> <span class="o">=</span> <span class="n">climatology</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">day</span><span class="p">)]</span>
        <span class="n">climatology</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">index</span>

        <span class="n">climatology_stdev</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">df2</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">df2</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">day</span><span class="p">])</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
        <span class="n">climatology_stdev</span> <span class="o">=</span> <span class="n">climatology_stdev</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">day</span><span class="p">)]</span>
        <span class="n">climatology_stdev</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">index</span>

        <span class="k">return</span> <span class="n">climatology</span><span class="p">,</span> <span class="n">climatology_stdev</span></div>


<div class="viewcode-block" id="TimeSeriesIrregular.make_monthly">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesIrregular.make_monthly">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">make_monthly</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate a :class:`TimeSeriesMonthly` from the :class:`TimeSeriesIrregular`. The monthly average is</span>
<span class="sd">        calculated from the mean of values within the month.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TimeSeriesMonthly</span>
<span class="sd">            Return a :class:`TimeSeriesMonthly` containing the monthly averages.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;yearmonth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span>

        <span class="n">grouped_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;yearmonth&#39;</span><span class="p">])[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">grouped_years</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;yearmonth&#39;</span><span class="p">])[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">grouped_months</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;yearmonth&#39;</span><span class="p">])[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="n">grouped_months</span> <span class="o">=</span> <span class="n">grouped_months</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">grouped_data</span> <span class="o">=</span> <span class="n">grouped_data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">grouped_years</span> <span class="o">=</span> <span class="n">grouped_years</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="n">grouped_months</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">grouped_months</span><span class="p">))</span>
        <span class="n">grouped_years</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">grouped_years</span><span class="p">))</span>

        <span class="n">monthly_series</span> <span class="o">=</span> <span class="n">TimeSeriesMonthly</span><span class="p">(</span><span class="n">grouped_years</span><span class="p">,</span> <span class="n">grouped_months</span><span class="p">,</span> <span class="n">grouped_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>

        <span class="n">monthly_series</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span><span class="s1">&#39;Calculated monthly average from values using arithmetic mean &#39;</span>
                                      <span class="s1">&#39;of all dates that fall within each month&#39;</span><span class="p">)</span>

        <span class="c1"># update attributes</span>
        <span class="n">monthly_series</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;time_resolution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;monthly&#39;</span>
        <span class="n">monthly_series</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;derived&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="n">monthly_series</span></div>


<div class="viewcode-block" id="TimeSeriesIrregular.get_start_and_end_dates">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesIrregular.get_start_and_end_dates">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_start_and_end_dates</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">datetime</span><span class="p">,</span> <span class="n">datetime</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the first and last dates in the dataset</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Tuple[datetime, datetime]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">time_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> \
                   <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">month</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:02d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">)</span> <span class="o">+</span> \
                   <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">day</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:02d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">time_str</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">n_time</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>

        <span class="n">start_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">end_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">n_time</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span></div>


<div class="viewcode-block" id="TimeSeriesIrregular.generate_dates">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesIrregular.generate_dates">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">generate_dates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_units</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a string specifying the required time units (something like days since 1800-01-01 00:00:00.0),</span>
<span class="sd">        generate a list of times from the time series corresponding to those units.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        time_units: str</span>
<span class="sd">            String specifying the units to use for generating the times e.g. &quot;days since 1800-01-01 00:00:00.0&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[int]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">time_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">month</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:02d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">day</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:02d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">time_str</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">dates</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">,</span> <span class="n">has_year_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="s1">&#39;standard&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dates</span></div>


<div class="viewcode-block" id="TimeSeriesIrregular.write_csv">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesIrregular.write_csv">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">write_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">metadata_filename</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write the timeseries to a csv file with the specified filename. The format used for writing is given</span>
<span class="sd">        by the BADC CSV format. This has a lot of upfront metadata before the data section. An option for writing a</span>
<span class="sd">        metadata file is also provided.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename: Path</span>
<span class="sd">            Path of the filename to write the data to</span>
<span class="sd">        metadata_filename: Path</span>
<span class="sd">            Path of the filename to write the metadata to</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">monthly</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">uncertainty</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">irregular</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">columns_to_write</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">write_generic_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">metadata_filename</span><span class="p">,</span> <span class="n">monthly</span><span class="p">,</span> <span class="n">uncertainty</span><span class="p">,</span> <span class="n">irregular</span><span class="p">,</span> <span class="n">columns_to_write</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeSeriesIrregular.get_year_axis">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesIrregular.get_year_axis">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_year_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a year in which all dates are represented as decimal years. January 1st 1984 is 1984.00.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[float]</span>
<span class="sd">            List of dates represented as decimal years.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">year_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">12.</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">365.</span>
        <span class="k">return</span> <span class="n">year_axis</span></div>


<div class="viewcode-block" id="TimeSeriesIrregular.get_string_date_range">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesIrregular.get_string_date_range">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_string_date_range</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a string which specifies the date range covered by the :class:`TimeSeriesIrregular` in the format</span>
<span class="sd">        YYYY.MM.DD-YYYY.MM.DD</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            String that specifies the date range covered</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_start_and_end_dates</span><span class="p">()</span>
        <span class="n">date_range</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">start_date</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">start_date</span><span class="o">.</span><span class="n">month</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">start_date</span><span class="o">.</span><span class="n">day</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">-&quot;</span> \
                     <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">end_date</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">end_date</span><span class="o">.</span><span class="n">month</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">end_date</span><span class="o">.</span><span class="n">day</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">date_range</span></div>


<div class="viewcode-block" id="TimeSeriesIrregular.rebaseline">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesIrregular.rebaseline">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">rebaseline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">baseline_start_year</span><span class="p">,</span> <span class="n">baseline_end_year</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shift the time series to a new baseline, specified by start and end years (inclusive).</span>
<span class="sd">        Each day is rebaselined separately, allowing for changes in seasonality. If years are</span>
<span class="sd">        incomplete, this might give a different result to the annual and monthly versions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        baseline_start_year : int</span>
<span class="sd">            The first year of the climatology period</span>
<span class="sd">        baseline_end_year : int</span>
<span class="sd">            The last year of the climatology period</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            Action occurs in place</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df_copy</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df_copy</span> <span class="o">=</span> <span class="n">df_copy</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>

        <span class="n">df2</span> <span class="o">=</span> <span class="n">df_copy</span><span class="p">[</span><span class="n">df_copy</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">baseline_start_year</span><span class="p">]</span>
        <span class="n">df2</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">baseline_end_year</span><span class="p">]</span>

        <span class="n">climatology</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">df2</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">df2</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">day</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">climatology</span> <span class="o">=</span> <span class="n">climatology</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">zip</span><span class="p">(</span><span class="n">df_copy</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">df_copy</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">day</span><span class="p">)]</span>
        <span class="n">climatology</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">df_copy</span><span class="o">.</span><span class="n">index</span>

        <span class="n">df_copy</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">df_copy</span><span class="o">.</span><span class="n">data</span> <span class="o">-</span> <span class="n">climatology</span>
        <span class="n">df_copy</span> <span class="o">=</span> <span class="n">df_copy</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_copy</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>

        <span class="c1"># update attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;climatology_start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">baseline_start_year</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;climatology_end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">baseline_end_year</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;actual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;Rebaselined to </span><span class="si">{</span><span class="n">baseline_start_year</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">baseline_end_year</span><span class="si">}</span><span class="s1"> for each month separately by calculating the &#39;</span>
            <span class="sa">f</span><span class="s1">&#39;arithmetic mean of the data over the baseline period and subtracting the mean from all data values. &#39;</span>
            <span class="sa">f</span><span class="s1">&#39;This is done for each month separately (Januarys, Februarys etc).&#39;</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TimeSeriesMonthly">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesMonthly">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TimeSeriesMonthly</span><span class="p">(</span><span class="n">TimeSeries</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A :class:`TimeSeriesMonthly` combines a pandas Dataframe with a</span>
<span class="sd">    :class:`CombinedMetadata` to bring together data and</span>
<span class="sd">    metadata in one object. It represents monthly averages of data.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">years</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">months</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">CombinedMetadata</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">uncertainty</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create :class:`TimeSeriesMonthly` object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        years : List[int]</span>
<span class="sd">            List of years</span>
<span class="sd">        months : List[int]</span>
<span class="sd">            List of months</span>
<span class="sd">        data : List[float]</span>
<span class="sd">            List of data values</span>
<span class="sd">        metadata : CombinedMetadata</span>
<span class="sd">            CombinedMetadata object containing the metadata</span>
<span class="sd">        uncertainty: Optional[List[float]]</span>

<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        df : pd.DataFrame</span>
<span class="sd">            Pandas dataframe used to contain the time and data information.</span>
<span class="sd">        metadata : dict</span>
<span class="sd">            Dictionary containing metadata. The only guaranteed entry is &quot;history&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>

        <span class="n">dico</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="n">years</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">:</span> <span class="n">months</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">uncertainty</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dico</span><span class="p">[</span><span class="s1">&#39;uncertainty&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uncertainty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dico</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">end_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_start_and_end_dates</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;last_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">end_date</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">out_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;TimeSeriesMonthly: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">out_str</span>

<div class="viewcode-block" id="TimeSeriesMonthly.make_from_df">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesMonthly.make_from_df">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">make_from_df</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">CombinedMetadata</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a :class:`TimeSeriesMonthly` from a pandas data frame.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        df : pd.DataFrame</span>
<span class="sd">            Pandas dataframe containing columns &#39;year&#39; &#39;month&#39; and &#39;data&#39; (optionally &#39;uncertainty&#39;)</span>
<span class="sd">        metadata : dict</span>
<span class="sd">            Dictionary containing the metadata</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TimeSeriesMonthly</span>
<span class="sd">            :class:`TimeSeriesMonthly` built from input components.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">years</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">months</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;uncertainty&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">uncertainty</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;uncertainty&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">TimeSeriesMonthly</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="n">months</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">uncertainty</span><span class="o">=</span><span class="n">uncertainty</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">TimeSeriesMonthly</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="n">months</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeSeriesMonthly.make_annual">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesMonthly.make_annual">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">make_annual</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cumulative</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate a :class:`TimeSeriesAnnual` from the :class:`TimeSeriesMonthly`. The annual average is</span>
<span class="sd">        calculated from the mean of available monthly values</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cumulative : bool</span>
<span class="sd">            Set to true to sum rather than average the monthly values to get the annual value.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TimeSeriesAnnual</span>
<span class="sd">            Return a :class:`TimeSeriesAnnual` object containing the annual averages.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cumulative</span><span class="p">:</span>
            <span class="n">grouped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;year&#39;</span><span class="p">])[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;uncertainty&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">grouped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;year&#39;</span><span class="p">])[[</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;uncertainty&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">grouped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;year&#39;</span><span class="p">])[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">annual_series</span> <span class="o">=</span> <span class="n">TimeSeriesAnnual</span><span class="o">.</span><span class="n">make_from_df</span><span class="p">(</span><span class="n">grouped</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cumulative</span><span class="p">:</span>
            <span class="n">annual_series</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span><span class="s1">&#39;Calculated annual value from monthly values by summing&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">annual_series</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span><span class="s1">&#39;Calculated annual average from monthly averages using arithmetic mean&#39;</span><span class="p">)</span>

        <span class="c1"># update attributes</span>
        <span class="n">annual_series</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;time_resolution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;annual&#39;</span>
        <span class="n">annual_series</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;derived&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="n">annual_series</span></div>


<div class="viewcode-block" id="TimeSeriesMonthly.make_annual_by_selecting_month">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesMonthly.make_annual_by_selecting_month">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">make_annual_by_selecting_month</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">month</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate a :class:`TimeSeriesAnnual` from the :class:`TimeSeriesMonthly`. The annual value is</span>
<span class="sd">        taken from one of the monthly values specified by the user.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TimeSeriesAnnual</span>
<span class="sd">            Return a :class:`TimeSeriesAnnual` object containing only the selected month from each year.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">month_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;January&#39;</span><span class="p">,</span> <span class="s1">&#39;February&#39;</span><span class="p">,</span> <span class="s1">&#39;March&#39;</span><span class="p">,</span> <span class="s1">&#39;April&#39;</span><span class="p">,</span> <span class="s1">&#39;May&#39;</span><span class="p">,</span> <span class="s1">&#39;June&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;July&#39;</span><span class="p">,</span> <span class="s1">&#39;August&#39;</span><span class="p">,</span> <span class="s1">&#39;September&#39;</span><span class="p">,</span> <span class="s1">&#39;October&#39;</span><span class="p">,</span> <span class="s1">&#39;November&#39;</span><span class="p">,</span> <span class="s1">&#39;December&#39;</span><span class="p">]</span>

        <span class="n">grouped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">month</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">annual_series</span> <span class="o">=</span> <span class="n">TimeSeriesAnnual</span><span class="o">.</span><span class="n">make_from_df</span><span class="p">(</span><span class="n">grouped</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
        <span class="n">annual_series</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;Calculated annual series by extracting </span><span class="si">{</span><span class="n">month_names</span><span class="p">[</span><span class="n">month</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1"> from each year&#39;</span>
        <span class="p">)</span>

        <span class="c1"># update attributes</span>
        <span class="n">annual_series</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;time_resolution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;annual&#39;</span>

        <span class="k">return</span> <span class="n">annual_series</span></div>


<div class="viewcode-block" id="TimeSeriesMonthly.calculate_climatology">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesMonthly.calculate_climatology">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_climatology</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">baseline_start_year</span><span class="p">,</span> <span class="n">baseline_end_year</span><span class="p">):</span>
        <span class="c1"># select part of series in climatology period</span>
        <span class="n">climatology_part</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">baseline_start_year</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">baseline_end_year</span><span class="p">)]</span>
        <span class="c1"># calculate monthly climatology</span>
        <span class="n">climatology</span> <span class="o">=</span> <span class="n">climatology_part</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;month&#39;</span><span class="p">])[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">climatology</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="s1">&#39;climatology&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">climatology</span></div>


<div class="viewcode-block" id="TimeSeriesMonthly.rebaseline">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesMonthly.rebaseline">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">rebaseline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">baseline_start_year</span><span class="p">,</span> <span class="n">baseline_end_year</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shift the time series to a new baseline, specified by start and end years (inclusive).</span>
<span class="sd">        Each month is rebaselined separately, allowing for changes in seasonality. If years are</span>
<span class="sd">        incomplete, this might give a different result to the annual version.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        baseline_start_year : int</span>
<span class="sd">            The first year of the climatology period</span>
<span class="sd">        baseline_end_year : int</span>
<span class="sd">            The last year of the climatology period</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            Action occurs in place</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="s1">&#39;climatology&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;climatology&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># select part of series in climatology period</span>
        <span class="n">climatology_part</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">baseline_start_year</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">baseline_end_year</span><span class="p">)]</span>

        <span class="c1"># calculate monthly climatology</span>
        <span class="n">climatology</span> <span class="o">=</span> <span class="n">climatology_part</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;month&#39;</span><span class="p">])[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">climatology</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="s1">&#39;climatology&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># join climatology to main time series</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">,</span> <span class="n">climatology</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="s1">&#39;m:m&#39;</span><span class="p">)</span>

        <span class="c1"># subtract climatology</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;climatology&#39;</span><span class="p">]</span>

        <span class="c1"># update attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;climatology_start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">baseline_start_year</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;climatology_end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">baseline_end_year</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;actual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;Rebaselined to </span><span class="si">{</span><span class="n">baseline_start_year</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">baseline_end_year</span><span class="si">}</span><span class="s1"> for each month separately by calculating the &#39;</span>
            <span class="sa">f</span><span class="s1">&#39;arithmetic mean of the data over the baseline period and subtracting the mean from all data values. &#39;</span>
            <span class="sa">f</span><span class="s1">&#39;This is done for each month separately (Januarys, Februarys etc).&#39;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TimeSeriesMonthly.get_value">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesMonthly.get_value">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">month</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the current value for a particular year and month</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        year: int</span>
<span class="sd">            Year for which the value is required.</span>
<span class="sd">        month: int</span>
<span class="sd">            Month  for which the value is required.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Optional[float]</span>
<span class="sd">            Value for the specified year and month or None if it does not exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">year</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">month</span><span class="p">)]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">out_value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">out_value</span> <span class="o">=</span> <span class="n">selection</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Selection is not unique </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">month</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">out_value</span></div>


<div class="viewcode-block" id="TimeSeriesMonthly.get_uncertainty">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesMonthly.get_uncertainty">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_uncertainty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">month</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the current uncertainty for a particular year and month</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        year: int</span>
<span class="sd">            Year for which the uncertainty is required.</span>
<span class="sd">        month: int</span>
<span class="sd">            Month for which the uncertainty is required.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Optional[float]</span>
<span class="sd">            Value for the specified year and month or None if it does not exist</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="s1">&#39;uncertainty&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">selection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">year</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">month</span><span class="p">)]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">out_value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">out_value</span> <span class="o">=</span> <span class="n">selection</span><span class="p">[</span><span class="s1">&#39;uncertainty&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Selection is not unique </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">month</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">out_value</span></div>


<div class="viewcode-block" id="TimeSeriesMonthly.zero_on_month">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesMonthly.zero_on_month">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">zero_on_month</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">month</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Zero data set on the value for a single month in a single year by substracting the value for that month</span>
<span class="sd">        from all values in the dataset.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        year: int</span>
<span class="sd">            Year of the month on which the data will be zeroed.</span>
<span class="sd">        month: int</span>
<span class="sd">            Month of the month on which the data will be zeroed.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">month_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;January&#39;</span><span class="p">,</span> <span class="s1">&#39;February&#39;</span><span class="p">,</span> <span class="s1">&#39;March&#39;</span><span class="p">,</span> <span class="s1">&#39;April&#39;</span><span class="p">,</span> <span class="s1">&#39;May&#39;</span><span class="p">,</span> <span class="s1">&#39;June&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;July&#39;</span><span class="p">,</span> <span class="s1">&#39;August&#39;</span><span class="p">,</span> <span class="s1">&#39;September&#39;</span><span class="p">,</span> <span class="s1">&#39;October&#39;</span><span class="p">,</span> <span class="s1">&#39;November&#39;</span><span class="p">,</span> <span class="s1">&#39;December&#39;</span><span class="p">]</span>

        <span class="n">zero_value</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Zeroed series on </span><span class="si">{</span><span class="n">month_names</span><span class="p">[</span><span class="n">month</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1"> by subtracting the value for that &#39;</span>
                            <span class="sa">f</span><span class="s1">&#39;month from all data values (see next entry)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_offset</span><span class="p">(</span><span class="n">zero_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manually_set_baseline</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeSeriesMonthly.get_rank_from_year_and_month">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesMonthly.get_rank_from_year_and_month">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_rank_from_year_and_month</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">month</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">versus_all_months</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a year and month, extract the rank of the data for that month. Ties are given the</span>
<span class="sd">        same rank, which is the lowest rank of the group. Default behaviour is to rank the month</span>
<span class="sd">        against the same month in all other years. Setting all to True as a keyword argument ranks</span>
<span class="sd">        the month against all other months in all other years.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        year : int</span>
<span class="sd">            Year of year-month pair for which we want the rank</span>
<span class="sd">        month : int</span>
<span class="sd">            Month of year-month pair for which we want the rank</span>
<span class="sd">        versus_all_months : bool</span>
<span class="sd">            If set then the ranking is done for the monthly value relative to all other months.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            Returns the rank of the specified year-month pair as compared to the same month in</span>
<span class="sd">            all other years. If &quot;versus_all_months&quot; is set then returns rank of the anomaly for a particular year</span>
<span class="sd">            and month ranked against all other years and months.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">versus_all_months</span><span class="p">:</span>
            <span class="n">month_select</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">month_select</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">month</span><span class="p">]</span>
        <span class="n">ranked</span> <span class="o">=</span> <span class="n">month_select</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">rank</span> <span class="o">=</span> <span class="n">ranked</span><span class="p">[(</span><span class="n">month_select</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">year</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">month_select</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">month</span><span class="p">)][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rank</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">rank</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="TimeSeriesMonthly.generate_dates">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesMonthly.generate_dates">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">generate_dates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_units</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a string specifying the required time units (something like days since 1800-01-01 00:00:00.0),</span>
<span class="sd">        generate a list of times from the time series corresponding to those units.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        time_units: str</span>
<span class="sd">            String specifying the units to use for generating the times e.g. &quot;days since 1800-01-01 00:00:00.0&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[int]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">time_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">month</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">time_str</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y%m&#39;</span><span class="p">)</span>
        <span class="n">dates</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                            <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">,</span>
                            <span class="n">has_year_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">calendar</span><span class="o">=</span><span class="s1">&#39;standard&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dates</span></div>


<div class="viewcode-block" id="TimeSeriesMonthly.write_csv">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesMonthly.write_csv">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">write_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">metadata_filename</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write the :class:`TimeSeriesMonthly` to a csv file with the specified filename. The format used for writing</span>
<span class="sd">        is given by the BADC CSV format. This has a lot of upfront metadata before the data section. An option for</span>
<span class="sd">        writing a metadata file is also provided.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename: Path</span>
<span class="sd">            Path of the filename to write the data to</span>
<span class="sd">        metadata_filename: Path</span>
<span class="sd">            Path of the filename to write the metadata to</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">columns_to_write</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">]</span>
        <span class="n">monthly</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">uncertainty</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">irregular</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">write_generic_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">metadata_filename</span><span class="p">,</span> <span class="n">monthly</span><span class="p">,</span> <span class="n">uncertainty</span><span class="p">,</span> <span class="n">irregular</span><span class="p">,</span> <span class="n">columns_to_write</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeSeriesMonthly.get_start_and_end_dates">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesMonthly.get_start_and_end_dates">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_start_and_end_dates</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">datetime</span><span class="p">,</span> <span class="n">datetime</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the first and last dates in the dataset</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Tuple[datetime, datetime]</span>
<span class="sd">            Start and end dates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">time_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">month</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">time_str</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y%m&#39;</span><span class="p">)</span>

        <span class="n">n_time</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>

        <span class="n">start_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">end_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">n_time</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span></div>


<div class="viewcode-block" id="TimeSeriesMonthly.get_year_axis">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesMonthly.get_year_axis">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_year_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a year axis as decimal year. 1st January 1984 is 1984.00.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[float]</span>
<span class="sd">            List of dates expressed as a decimal year.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">year_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">12.</span>
        <span class="k">return</span> <span class="n">year_axis</span></div>


<div class="viewcode-block" id="TimeSeriesMonthly.get_string_date_range">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesMonthly.get_string_date_range">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_string_date_range</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a string which specifies the date range covered by the :class:`TimeSeriesMonthly` in the format</span>
<span class="sd">        YYYY.MM-YYYY.MM</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            String that specifies the date range covered</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_start_and_end_dates</span><span class="p">()</span>
        <span class="n">date_range</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">start_date</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">start_date</span><span class="o">.</span><span class="n">month</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">-&quot;</span> \
                     <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">end_date</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">end_date</span><span class="o">.</span><span class="n">month</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">date_range</span></div>


<div class="viewcode-block" id="TimeSeriesMonthly.running_mean">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesMonthly.running_mean">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">running_mean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_length</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">centred</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate running mean of the data for a specified run length</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        run_length : int</span>
<span class="sd">            length of the run</span>
<span class="sd">        centred: bool</span>
<span class="sd">            Set to True to centre the times associated to the data points, otherwise the time used will be the last</span>
<span class="sd">            time in the n-year run.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TimeSeriesMonthly</span>
<span class="sd">            :class:`TimeSeriesMonthly` containing running averages of length run_length. Where there are too few</span>
<span class="sd">            years to calculate a running average, np.nan appears in the data column of the data frame</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">moving_average</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">moving_average</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">moving_average</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">run_length</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">centred</span><span class="p">:</span>
            <span class="n">moving_average</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">moving_average</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">run_length</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">moving_average</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">centred</span><span class="p">:</span>
            <span class="n">moving_average</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Calculated </span><span class="si">{</span><span class="n">run_length</span><span class="si">}</span><span class="s1">-month moving average centred on the middle month of the period&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">moving_average</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Calculated </span><span class="si">{</span><span class="n">run_length</span><span class="si">}</span><span class="s1">-month trailing moving average&#39;</span><span class="p">)</span>

        <span class="n">moving_average</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;derived&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="n">moving_average</span></div>


<div class="viewcode-block" id="TimeSeriesMonthly.lowess">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesMonthly.lowess">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">lowess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number_of_points</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">60</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Lowess smooth the series</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        number_of_points: int</span>
<span class="sd">            Number of points to use in the lowess smoother</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">moving_average</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">snippet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">data</span><span class="p">[:]</span>
        <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_year_axis</span><span class="p">()[:]</span>

        <span class="n">fraction_of_data</span> <span class="o">=</span> <span class="n">number_of_points</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">snippet</span><span class="p">)</span>

        <span class="n">fit</span> <span class="o">=</span> <span class="n">lowess</span><span class="p">(</span><span class="n">snippet</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">fraction_of_data</span><span class="p">)</span>

        <span class="c1"># Smoothing is different at ends of series (effectively extrapolation) so terminate half filter width from ends</span>
        <span class="n">fit</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="c1"># fit[0: int(number_of_points / 2)] = np.nan</span>
        <span class="c1"># fit[-1 * int(number_of_points / 2):] = np.nan</span>

        <span class="n">moving_average</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">fit</span>

        <span class="n">moving_average</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;Calculated lowess smoothed series with </span><span class="si">{</span><span class="n">fraction_of_data</span><span class="si">}</span><span class="s1"> of data used for each fit&#39;</span><span class="p">)</span>
        <span class="n">moving_average</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;derived&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">moving_average</span></div>
</div>



<div class="viewcode-block" id="TimeSeriesAnnual">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesAnnual">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TimeSeriesAnnual</span><span class="p">(</span><span class="n">TimeSeries</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A :class:`TimeSeriesAnnual` combines a pandas Dataframe with a</span>
<span class="sd">    :class:`.CombinedMetadata` to bring together data and</span>
<span class="sd">    metadata in one object. It represents annual averages of data.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">years</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">uncertainty</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create :class:`TimeSeriesAnnual` object from its components.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        years : list</span>
<span class="sd">            List of years</span>
<span class="sd">        data : list</span>
<span class="sd">            List of data values</span>
<span class="sd">        metadata : CombinedMetadata</span>
<span class="sd">            Dictionary containing the metadata</span>

<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        df : pd.DataFrame</span>
<span class="sd">            Pandas dataframe containing the time and data information</span>
<span class="sd">        metadata : dict</span>
<span class="sd">            Dictionary containing the metadata. The only guaranteed entry is &#39;history&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>

        <span class="n">dico</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="n">years</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">uncertainty</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dico</span><span class="p">[</span><span class="s1">&#39;uncertainty&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uncertainty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dico</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">out_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;TimeSeriesAnnual: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">out_str</span>

<div class="viewcode-block" id="TimeSeriesAnnual.make_from_df">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesAnnual.make_from_df">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">make_from_df</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">CombinedMetadata</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a :class:`TimeSeriesAnnual` from a pandas data frame.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        df : pd.DataFrame</span>
<span class="sd">            Pandas dataframe containing columns &#39;year&#39; and &#39;data&#39;</span>
<span class="sd">        metadata : dict</span>
<span class="sd">            Dictionary containing the metadata</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TimeSeriesAnnual</span>
<span class="sd">            :class:`TimeSeriesAnnual` created from the elements in the dataframe and metadata.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">years</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;uncertainty&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">uncertainty</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;uncertainty&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">TimeSeriesAnnual</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">uncertainty</span><span class="o">=</span><span class="n">uncertainty</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">TimeSeriesAnnual</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeSeriesAnnual.rebaseline">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesAnnual.rebaseline">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">rebaseline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">baseline_start_year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">baseline_end_year</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shift the :class:`TimeSeriesAnnual` to a new baseline, specified by start and end years (inclusive).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        baseline_start_year : int</span>
<span class="sd">            First year of the climatology period</span>
<span class="sd">        baseline_end_year : int</span>
<span class="sd">            Last year of the climatology period</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            Action occurs in place.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># select part of series in climatology period</span>
        <span class="n">climatology_part</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">baseline_start_year</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">baseline_end_year</span><span class="p">)]</span>

        <span class="c1"># calculate monthly climatology</span>
        <span class="n">climatology</span> <span class="o">=</span> <span class="n">climatology_part</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

        <span class="c1"># subtract climatology</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">climatology</span>

        <span class="c1"># update attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;climatology_start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">baseline_start_year</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;climatology_end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">baseline_end_year</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;actual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Rebaselined to </span><span class="si">{</span><span class="n">baseline_start_year</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">baseline_end_year</span><span class="si">}</span><span class="s1"> by subtracting the arithemtic &#39;</span>
                            <span class="sa">f</span><span class="s1">&#39;mean for that period from all data values.&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeSeriesAnnual.time_average">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesAnnual.time_average">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">time_average</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="c1"># select part of series in climatology period</span>
        <span class="n">climatology_part</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start_year</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end_year</span><span class="p">)]</span>
        <span class="c1"># calculate monthly climatology</span>
        <span class="n">climatology</span> <span class="o">=</span> <span class="n">climatology_part</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">climatology</span></div>


<div class="viewcode-block" id="TimeSeriesAnnual.get_rank_from_year">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesAnnual.get_rank_from_year">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_rank_from_year</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a year, extract the rank of the data for that year. Ties are given the</span>
<span class="sd">        same rank, which is the lowest rank of the group.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        year : int</span>
<span class="sd">            Year for which we want the rank</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Optional[int]</span>
<span class="sd">            Rank of specified year or None if year is not available.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ranked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">rank</span> <span class="o">=</span> <span class="n">ranked</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">year</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rank</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">rank</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>


<div class="viewcode-block" id="TimeSeriesAnnual.get_value_from_year">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesAnnual.get_value_from_year">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_value_from_year</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the data value for a specified year.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        year : int</span>
<span class="sd">            Year for which a value is desired</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Optional[float]</span>
<span class="sd">            Value for the year, or None if year is not in the data set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">year</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">val</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>


<div class="viewcode-block" id="TimeSeriesAnnual.get_uncertainty_from_year">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesAnnual.get_uncertainty_from_year">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_uncertainty_from_year</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the data value for a specified year.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        year : int</span>
<span class="sd">            Year for which a value is desired</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Optional[float]</span>
<span class="sd">            Uncertainty for the year, or None if year is not in the data set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;uncertainty&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">year</span><span class="p">][</span><span class="s1">&#39;uncertainty&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">val</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>


<div class="viewcode-block" id="TimeSeriesAnnual.get_year_from_rank">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesAnnual.get_year_from_rank">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_year_from_rank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rank</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a particular rank, extract a list of years which match that rank.</span>
<span class="sd">        Returns a list because years can (theoretically) be tied with each other. Rank</span>
<span class="sd">        1 corresponds to the highest value in the dataset.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rank : int</span>
<span class="sd">            Rank for which we want the year which has that rank</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[int]</span>
<span class="sd">            List of years that have the specified rank</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ranked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">years</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">ranked</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">rank</span><span class="p">][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">years</span></div>


<div class="viewcode-block" id="TimeSeriesAnnual.running_mean">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesAnnual.running_mean">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">running_mean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_length</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">centred</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate running mean of the data for a specified run length</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        run_length : int</span>
<span class="sd">            length of the run</span>
<span class="sd">        centred: bool</span>
<span class="sd">            Set to True to centre the times associated to the data points, otherwise the time used will be the last</span>
<span class="sd">            time in the n-year run.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TimeSeriesAnnual</span>
<span class="sd">            :class:`TimeSeriesAnnual` containing running averages of length run_length. Where there are too few</span>
<span class="sd">            years to calculate a running average, np.nan appears in the data column of the data frame</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">moving_average</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">moving_average</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">moving_average</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">run_length</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">centred</span><span class="p">:</span>
            <span class="n">moving_average</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">moving_average</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">run_length</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">moving_average</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">centred</span><span class="p">:</span>
            <span class="n">moving_average</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Calculated </span><span class="si">{</span><span class="n">run_length</span><span class="si">}</span><span class="s1">-year moving average centred on the middle year of the period&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">moving_average</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Calculated </span><span class="si">{</span><span class="n">run_length</span><span class="si">}</span><span class="s1">-year moving average&#39;</span><span class="p">)</span>

        <span class="n">moving_average</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;derived&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="n">moving_average</span></div>


<div class="viewcode-block" id="TimeSeriesAnnual.running_trend">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesAnnual.running_trend">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">running_trend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_length</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate a smoothed series by fitting a straight line to the past 30 years of data and</span>
<span class="sd">        taking the final point as the data value instead</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        run_length: int</span>
<span class="sd">            Number of years for which the trend should be calculated</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TimeSeriesAnnual</span>
<span class="sd">            :class:`TimeSeriesAnnual` containing the end point of trends of length run_length. Where there are too few</span>
<span class="sd">            years to calculate a trend, np.nan appears in the data column of the data frame</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">moving_average</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">moving_average</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">run_length</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">run_length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">data</span><span class="p">)):</span>
            <span class="n">snippet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">run_length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_year_axis</span><span class="p">()[</span><span class="n">i</span> <span class="o">-</span> <span class="n">run_length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

            <span class="n">m</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">snippet</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">moving_average</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span> <span class="o">+</span> <span class="n">m</span> <span class="o">*</span> <span class="n">time</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">moving_average</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Calculated smoothed series with </span><span class="si">{</span><span class="n">run_length</span><span class="si">}</span><span class="s1">-year trends&#39;</span><span class="p">)</span>
        <span class="n">moving_average</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;derived&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="n">moving_average</span></div>


<div class="viewcode-block" id="TimeSeriesAnnual.running_lowess">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesAnnual.running_lowess">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">running_lowess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number_of_points</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Lowess smooth time point t by running a lowess smoother from t=0 to t=t. For a regular lowess</span>
<span class="sd">        smoother see method lowess.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        number_of_points: int</span>
<span class="sd">            Number of points to use in the lowess smoother</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">moving_average</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">moving_average</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">number_of_points</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_points</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">data</span><span class="p">)):</span>
            <span class="n">snippet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_year_axis</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

            <span class="n">fraction_of_data</span> <span class="o">=</span> <span class="n">number_of_points</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">snippet</span><span class="p">)</span>

            <span class="n">fit</span> <span class="o">=</span> <span class="n">lowess</span><span class="p">(</span><span class="n">snippet</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">fraction_of_data</span><span class="p">)</span>
            <span class="n">moving_average</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="n">moving_average</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;Calculated lowess smoothed series with </span><span class="si">{</span><span class="n">fraction_of_data</span><span class="si">}</span><span class="s1"> of data used for each fit&#39;</span><span class="p">)</span>
        <span class="n">moving_average</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;derived&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">moving_average</span></div>


<div class="viewcode-block" id="TimeSeriesAnnual.lowess">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesAnnual.lowess">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">lowess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number_of_points</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Lowess smooth the series</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        number_of_points: int</span>
<span class="sd">            Number of points to use in the lowess smoother</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">moving_average</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">snippet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">data</span><span class="p">[:]</span>
        <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_year_axis</span><span class="p">()[:]</span>

        <span class="n">fraction_of_data</span> <span class="o">=</span> <span class="n">number_of_points</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">snippet</span><span class="p">)</span>

        <span class="n">fit</span> <span class="o">=</span> <span class="n">lowess</span><span class="p">(</span><span class="n">snippet</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">fraction_of_data</span><span class="p">)</span>
        <span class="n">moving_average</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">data</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="n">moving_average</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;Calculated lowess smoothed series with </span><span class="si">{</span><span class="n">fraction_of_data</span><span class="si">}</span><span class="s1"> of data used for each fit&#39;</span><span class="p">)</span>
        <span class="n">moving_average</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;derived&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">moving_average</span></div>


<div class="viewcode-block" id="TimeSeriesAnnual.running_stdev">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesAnnual.running_stdev">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">running_stdev</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_length</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">centred</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate running standard deviation of the data for a specified run length</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        run_length : int</span>
<span class="sd">            length of the run</span>
<span class="sd">        centred: bool</span>
<span class="sd">            Set to True to centre the times associated to the data points, otherwise the time used will be the last</span>
<span class="sd">            time in the n-year run.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TimeSeriesAnnual</span>
<span class="sd">            :class:`TimeSeriesAnnual` containing running standard deviation of length run_length. Where there are too few</span>
<span class="sd">            years to calculate a running average, np.nan appears in the data column of the data frame</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">moving_average</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">moving_average</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">moving_average</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">run_length</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">centred</span><span class="p">:</span>
            <span class="n">moving_average</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">moving_average</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">run_length</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">moving_average</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">centred</span><span class="p">:</span>
            <span class="n">moving_average</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Calculated </span><span class="si">{</span><span class="n">run_length</span><span class="si">}</span><span class="s1">-year moving standard deviation centred on the middle year of the period&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">moving_average</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Calculated </span><span class="si">{</span><span class="n">run_length</span><span class="si">}</span><span class="s1">-year moving standard deviation&#39;</span><span class="p">)</span>

        <span class="n">moving_average</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;derived&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="n">moving_average</span></div>


<div class="viewcode-block" id="TimeSeriesAnnual.record_margins">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesAnnual.record_margins">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">record_margins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">n_years</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">)</span>

        <span class="n">out_series</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">out_series</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_years</span><span class="p">):</span>
            <span class="n">over_margin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">i</span><span class="p">])</span>
            <span class="n">under_margin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">i</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">over_margin</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">out_series</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">over_margin</span>
            <span class="k">elif</span> <span class="n">under_margin</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">out_series</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">under_margin</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out_series</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="k">return</span> <span class="n">out_series</span></div>


<div class="viewcode-block" id="TimeSeriesAnnual.select_decade">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesAnnual.select_decade">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">select_decade</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">end_year</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select every tenth year from the :class:`TimesSeriesAnnual`, the last digit of the years can</span>
<span class="sd">        be selected using the end_year keyword argument. The default is to select all years ending in 0,</span>
<span class="sd">        e.g. 1850, 1860, 1870... 2020.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        end_year: int</span>
<span class="sd">            Last digit of the years to be selected. e.g. set to 0 to pick 1850, 1860... 2010, 2020 etc.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TimeSeriesAnnual</span>
<span class="sd">            :class:`TimeSeriesAnnual` containing every tenth year</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="n">end_year</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;derived&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Selected years ending in </span><span class="si">{</span><span class="n">end_year</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="TimeSeriesAnnual.generate_dates">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesAnnual.generate_dates">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">generate_dates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_units</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">datetime</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a string specifying the required time units (something like days since 1800-01-01 00:00:00.0),</span>
<span class="sd">        generate a list of times from the time series corresponding to those units.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        time_units: str</span>
<span class="sd">            String specifying the units to use for generating the times e.g. &quot;days since 1800-01-01 00:00:00.0&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[datetime]</span>
<span class="sd">            List of dates</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y&#39;</span><span class="p">)</span>
        <span class="n">dates</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">,</span> <span class="n">has_year_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="s1">&#39;standard&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dates</span></div>


<div class="viewcode-block" id="TimeSeriesAnnual.write_csv">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesAnnual.write_csv">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">write_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">metadata_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write the timeseries to a csv file with the specified filename. The format used for writing is given</span>
<span class="sd">        by the BADC CSV format. This has a lot of upfront metadata before the data section. An option for writing a</span>
<span class="sd">        metadata file is also provided.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename: Path</span>
<span class="sd">            Path of the filename to write the data to</span>
<span class="sd">        metadata_filename: Path</span>
<span class="sd">            Path of the filename to write the metadata to</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">monthly</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">irregular</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">uncertainty</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">columns_to_write</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;uncertainty&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">uncertainty</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">columns_to_write</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;uncertainty&#39;</span><span class="p">]</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">write_generic_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">metadata_filename</span><span class="p">,</span> <span class="n">monthly</span><span class="p">,</span> <span class="n">uncertainty</span><span class="p">,</span> <span class="n">irregular</span><span class="p">,</span> <span class="n">columns_to_write</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeSeriesAnnual.write_simple_csv">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesAnnual.write_simple_csv">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">write_simple_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeSeriesAnnual.get_year_axis">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesAnnual.get_year_axis">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_year_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a year axis with dates represented as decimal years.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[float]</span>
<span class="sd">            List of dates as decimal years.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">year_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">year_axis</span></div>


<div class="viewcode-block" id="TimeSeriesAnnual.get_string_date_range">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesAnnual.get_string_date_range">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_string_date_range</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a string which specifies the date range covered by the :class:`TimeSeriesAnnual` in the format</span>
<span class="sd">        YYYY-YYYY</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            String that specifies the date range covered</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_first_and_last_year</span><span class="p">()</span>
        <span class="n">date_range</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">start_year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">end_year</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">date_range</span></div>


<div class="viewcode-block" id="TimeSeriesAnnual.add_year">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.TimeSeriesAnnual.add_year">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_year</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">uncertainty</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a year of data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        year: int</span>
<span class="sd">            the year to be added</span>
<span class="sd">        value: float</span>
<span class="sd">            the data value to be added</span>
<span class="sd">        uncertainty:</span>
<span class="sd">            the uncertainty of the data value to be added (optional)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">year</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
            <span class="n">dict_to_add</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="n">year</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">uncertainty</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dict_to_add</span><span class="p">[</span><span class="s1">&#39;uncertainty&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uncertainty</span>
            <span class="n">mini_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">dict_to_add</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">,</span> <span class="n">mini_df</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Year </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2"> already exists. No change&quot;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="get_start_and_end_year">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.get_start_and_end_year">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_start_and_end_year</span><span class="p">(</span><span class="n">all_datasets</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TimeSeriesAnnual</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a list of :class:`TimeSeriesAnnual`, extract the first year in any of the data</span>
<span class="sd">    sets and the last year in any of the data sets.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    all_datasets: List[TimeSeriesAnnual]</span>
<span class="sd">        List of datasets from which to extract the earliest first year and latest final year.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Tuple[Optional[int], Optional[int]]</span>
<span class="sd">        Return the first and last years in the list of data sets</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_datasets</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="n">first_years</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">last_years</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">all_datasets</span><span class="p">:</span>
        <span class="n">first_year</span><span class="p">,</span> <span class="n">last_year</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">get_first_and_last_year</span><span class="p">()</span>
        <span class="n">first_years</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">first_year</span><span class="p">)</span>
        <span class="n">last_years</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">last_year</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">first_years</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">last_years</span><span class="p">)</span></div>



<div class="viewcode-block" id="make_combined_series">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.make_combined_series">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">make_combined_series</span><span class="p">(</span><span class="n">all_datasets</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TimeSeriesAnnual</span><span class="p">],</span> <span class="n">augmented_uncertainty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TimeSeriesAnnual</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Combine a list of datasets into a single :class:`TimeSeriesAnnual` by taking the arithmetic mean</span>
<span class="sd">    of all available datasets for each year. Merges the metadata for all the input time series.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    all_datasets: List[TimeSeriesAnnual]</span>
<span class="sd">        List of datasets to be combined</span>
<span class="sd">    augmented_uncertainty: bool</span>
<span class="sd">        Set to True if you want to add an additional uncertainty from the baseline</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    TimeSeriesAnnual</span>
<span class="sd">        :class:`TimeSeriesAnnual` which is the mean of all availabale datasets in each year.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data_frames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">all_datasets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
    <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Combined&#39;</span>
    <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;display_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Combined series&#39;</span>
    <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;colour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;#ff0000&#39;</span>
    <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;zpos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">list_attributes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;citation&#39;</span><span class="p">,</span> <span class="s1">&#39;citation_url&#39;</span><span class="p">,</span> <span class="s1">&#39;data_citation&#39;</span><span class="p">,</span> <span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="s1">&#39;history&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ds</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">all_datasets</span><span class="p">):</span>
        <span class="n">dfi</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">df</span><span class="p">)</span>
        <span class="n">dfi</span> <span class="o">=</span> <span class="n">dfi</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;data_</span><span class="si">{</span><span class="n">ds</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">})</span>
        <span class="k">if</span> <span class="s1">&#39;index&#39;</span> <span class="ow">in</span> <span class="n">dfi</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">dfi</span> <span class="o">=</span> <span class="n">dfi</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;time&#39;</span> <span class="ow">in</span> <span class="n">dfi</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">dfi</span> <span class="o">=</span> <span class="n">dfi</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
        <span class="n">data_frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dfi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">att</span> <span class="ow">in</span> <span class="n">list_attributes</span><span class="p">:</span>
                <span class="n">metadata</span><span class="p">[</span><span class="n">att</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="n">att</span><span class="p">])</span>

    <span class="n">df_merged</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="s1">&#39;m:m&#39;</span><span class="p">),</span> <span class="n">data_frames</span><span class="p">,)</span>

    <span class="n">columns</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df_merged</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;data&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
            <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>

    <span class="n">unc_columns</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df_merged</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;uncertainty&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
            <span class="n">unc_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>

    <span class="n">df_merged</span><span class="p">[</span><span class="s1">&#39;combined&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_merged</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">df_merged</span><span class="p">[</span><span class="s1">&#39;uncertainty_a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_merged</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">df_merged</span><span class="p">[</span><span class="s1">&#39;uncertainty_a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">df_merged</span><span class="p">[</span><span class="s1">&#39;uncertainty_a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_merged</span><span class="p">[</span><span class="s1">&#39;uncertainty_a&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.645</span>

    <span class="k">if</span> <span class="n">augmented_uncertainty</span><span class="p">:</span>
        <span class="n">df_merged</span><span class="p">[</span><span class="s1">&#39;uncertainty&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">df_merged</span><span class="p">[</span><span class="s1">&#39;uncertainty_a&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mf">0.12</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">df_merged</span><span class="p">[</span><span class="s1">&#39;uncertainty_b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_merged</span><span class="p">[</span><span class="n">unc_columns</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">df_merged</span><span class="p">[</span><span class="s1">&#39;uncertainty&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">df_merged</span><span class="p">[</span><span class="s1">&#39;uncertainty_a&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">df_merged</span><span class="p">[</span><span class="s1">&#39;uncertainty_b&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">df_merged</span> <span class="o">=</span> <span class="n">df_merged</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">df_merged</span> <span class="o">=</span> <span class="n">df_merged</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;combined&#39;</span><span class="p">:</span> <span class="s1">&#39;data&#39;</span><span class="p">})</span>

    <span class="n">df_merged</span> <span class="o">=</span> <span class="n">df_merged</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df_merged</span> <span class="o">=</span> <span class="n">df_merged</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

    <span class="n">to_drop</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df_merged</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;index_&#39;</span> <span class="ow">in</span> <span class="n">col</span> <span class="ow">or</span> <span class="s1">&#39;time_&#39;</span> <span class="ow">in</span> <span class="n">col</span> <span class="ow">or</span> <span class="s1">&#39;level_&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
            <span class="n">to_drop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>

    <span class="n">df_merged</span> <span class="o">=</span> <span class="n">df_merged</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">to_drop</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">TimeSeriesAnnual</span><span class="o">.</span><span class="n">make_from_df</span><span class="p">(</span><span class="n">df_merged</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span></div>



<div class="viewcode-block" id="get_list_of_unique_variables">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.get_list_of_unique_variables">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_list_of_unique_variables</span><span class="p">(</span><span class="n">all_datasets</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TimeSeriesAnnual</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a list of :class:`TimeSeriesAnnual`, get a list of the unique variable names represented in</span>
<span class="sd">    that list.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    all_datasets: List[TimeSeriesAnnual]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    List[str]</span>
<span class="sd">        List of the unique variable names.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># get list of all unique variables</span>
    <span class="n">variables</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">all_datasets</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ds</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
            <span class="n">variables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">variables</span></div>



<div class="viewcode-block" id="superset_dataset_list">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.superset_dataset_list">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">superset_dataset_list</span><span class="p">(</span><span class="n">all_datasets</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TimeSeriesAnnual</span><span class="p">],</span> <span class="n">variables</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">TimeSeriesAnnual</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a list of variables, create a list where each entry is a list of all :class:`TimeSeriesAnnual` objects</span>
<span class="sd">    corresponding to the variable in that index position.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    all_datasets: List[TimeSeriesAnnual]</span>
<span class="sd">        List of datasets</span>
<span class="sd">    variables: List[str]</span>
<span class="sd">        List of variable names</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    List[List[TimeSeriesAnnual]]</span>
<span class="sd">        List of lists of :class:`TimeSeriesAnnual`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">superset</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
        <span class="n">superset</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>

    <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">all_datasets</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">variables</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">])</span>
        <span class="n">superset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">superset</span></div>



<div class="viewcode-block" id="write_dataset_summary_file">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.write_dataset_summary_file">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">write_dataset_summary_file</span><span class="p">(</span><span class="n">all_datasets</span><span class="p">,</span> <span class="n">csv_filename</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_datasets</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">dataframes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dataset_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">all_datasets</span><span class="p">:</span>
        <span class="n">dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">df</span><span class="p">)</span>
        <span class="n">dataset_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>

    <span class="n">ds</span> <span class="o">=</span> <span class="n">all_datasets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Find the first and last years from all the dataframes</span>
    <span class="n">min_year</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dataframes</span><span class="p">)</span>
    <span class="n">max_year</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dataframes</span><span class="p">)</span>

    <span class="c1"># Create a new dataframe that covers the whole date range</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">TimeSeriesAnnual</span><span class="p">):</span>
        <span class="n">combined_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="n">min_year</span><span class="p">,</span> <span class="n">max_year</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)})</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">TimeSeriesMonthly</span><span class="p">):</span>
        <span class="c1"># build a dataframe from all the unique year-month pairs in the input datasets</span>
        <span class="n">combined_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">]]</span> <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dataframes</span><span class="p">])</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># Add columns for &quot;data&quot; from each dataframe and rename to the display_name</span>
    <span class="k">for</span> <span class="n">df</span><span class="p">,</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dataframes</span><span class="p">,</span> <span class="n">dataset_names</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;data&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">TimeSeriesAnnual</span><span class="p">):</span>
                <span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">combined_df</span><span class="p">,</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">]],</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="s1">&#39;m:m&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">TimeSeriesMonthly</span><span class="p">):</span>
                <span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">combined_df</span><span class="p">,</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">]],</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                                     <span class="n">validate</span><span class="o">=</span><span class="s1">&#39;m:m&#39;</span><span class="p">)</span>

            <span class="n">merged_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">col_name</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">combined_df</span> <span class="o">=</span> <span class="n">merged_df</span>

    <span class="c1"># Write the combined DataFrame to the specified output path as a CSV file</span>
    <span class="n">combined_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">float_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.4f</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">combined_df</span></div>



<div class="viewcode-block" id="create_common_dataframe">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.create_common_dataframe">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">create_common_dataframe</span><span class="p">(</span>
        <span class="n">dataframes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span>
        <span class="n">monthly</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">annual</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">irregular</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a list of dataframes make a single dataframe which has rows corresponding to all time steps in the</span>
<span class="sd">    input dataframes</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dataframes: List[pd.DataFrame]</span>
<span class="sd">        List of dataframes which are to be used as the basis for the common data frame</span>
<span class="sd">    monthly: bool</span>
<span class="sd">        Set to true for monthly data</span>
<span class="sd">    annual: bool</span>
<span class="sd">        Set to true for annual data</span>
<span class="sd">    irregular: bool</span>
<span class="sd">        Set to true for daily/irregular data</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">        Pandas dataframe with one row for each row in the input dataframes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">sum</span><span class="p">([</span><span class="n">annual</span><span class="p">,</span> <span class="n">monthly</span><span class="p">,</span> <span class="n">irregular</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;One and only one flag must be set to True&quot;</span><span class="p">)</span>

    <span class="c1"># Create a new dataframe that covers the whole date range from unique data combinations</span>
    <span class="k">if</span> <span class="n">annual</span><span class="p">:</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">monthly</span><span class="p">:</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">irregular</span><span class="p">:</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="s1">&#39;time&#39;</span> <span class="ow">in</span> <span class="n">dataframes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>

    <span class="n">common_dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span> <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dataframes</span><span class="p">])</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">common_dataframe</span></div>



<div class="viewcode-block" id="equalise_datasets">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.equalise_datasets">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">equalise_datasets</span><span class="p">(</span>
        <span class="n">all_datasets</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">TimeSeriesAnnual</span><span class="p">,</span> <span class="n">TimeSeriesMonthly</span><span class="p">,</span> <span class="n">TimeSeriesIrregular</span><span class="p">]]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a list of datasets</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    all_datasets: List[Union[TimeSeriesAnnual, TimeSeriesMonthly, TimeSeriesIrregular]]</span>
<span class="sd">        List of time series datasets whose data is to be combined in a single data frame. The data column from</span>
<span class="sd">        each data set will be combined into a single data from with each data column becoming a column identified</span>
<span class="sd">        by the &quot;name&quot; of the data set from its metadata.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">        Pandas dataframe containing the data columns from all the input datasets.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_datasets</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">all_datasets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">df</span>

    <span class="n">dataframes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">all_datasets</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;data&#39;</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">df</span><span class="p">)</span>

    <span class="n">ds</span> <span class="o">=</span> <span class="n">all_datasets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">monthly</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">TimeSeriesMonthly</span><span class="p">)</span>
    <span class="n">annual</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">TimeSeriesAnnual</span><span class="p">)</span>
    <span class="n">irregular</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">TimeSeriesIrregular</span><span class="p">)</span>

    <span class="n">combined_df</span> <span class="o">=</span> <span class="n">create_common_dataframe</span><span class="p">(</span><span class="n">dataframes</span><span class="p">,</span> <span class="n">monthly</span><span class="o">=</span><span class="n">monthly</span><span class="p">,</span> <span class="n">annual</span><span class="o">=</span><span class="n">annual</span><span class="p">,</span> <span class="n">irregular</span><span class="o">=</span><span class="n">irregular</span><span class="p">)</span>

    <span class="n">on_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">monthly</span><span class="p">:</span>
        <span class="n">on_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">irregular</span><span class="p">:</span>
        <span class="n">on_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">]</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">on_columns</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">]</span>

    <span class="c1"># for each dataset in the list, merge it with the combined dataframe, rename the data column and</span>
    <span class="c1"># update the combined dataframe</span>
    <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">all_datasets</span><span class="p">:</span>
        <span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">combined_df</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">columns</span><span class="p">],</span> <span class="n">on</span><span class="o">=</span><span class="n">on_columns</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="s1">&#39;m:m&#39;</span><span class="p">)</span>
        <span class="n">merged_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">ds</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">combined_df</span> <span class="o">=</span> <span class="n">merged_df</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">on_columns</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">]</span>

    <span class="n">combined_df</span> <span class="o">=</span> <span class="n">combined_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">on_columns</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">combined_df</span> <span class="o">=</span> <span class="n">combined_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">combined_df</span></div>



<div class="viewcode-block" id="write_dataset_summary_file_with_metadata">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.write_dataset_summary_file_with_metadata">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">write_dataset_summary_file_with_metadata</span><span class="p">(</span>
        <span class="n">all_datasets</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">TimeSeriesAnnual</span><span class="p">,</span> <span class="n">TimeSeriesMonthly</span><span class="p">,</span> <span class="n">TimeSeriesIrregular</span><span class="p">]],</span>
        <span class="n">csv_filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a list of time series data sets, write them out in a single BADC CSV format csv file with</span>
<span class="sd">    complete metadata.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    all_datasets: List[Union[TimeSeriesAnnual, TimeSeriesMonthly, TimeSeriesIrregular]]</span>
<span class="sd">        A list of time series which are going to be equalised</span>
<span class="sd">    csv_filename: str or Path</span>
<span class="sd">        The name of the file to which the summary will be written.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Set up the information to fill the template</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
    <span class="n">climind_version</span> <span class="o">=</span> <span class="n">pkg_resources</span><span class="o">.</span><span class="n">get_distribution</span><span class="p">(</span><span class="s2">&quot;climind&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">version</span>
    <span class="n">time_units</span> <span class="o">=</span> <span class="s1">&#39;days since 1800-01-01 00:00:00.0&#39;</span>
    <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">all_datasets</span><span class="p">:</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">generate_dates</span><span class="p">(</span><span class="n">time_units</span><span class="p">)</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">all_datasets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># To print out the datasets together, it&#39;s necessary to put them on the same time axis</span>
    <span class="n">common_datasets</span> <span class="o">=</span> <span class="n">equalise_datasets</span><span class="p">(</span><span class="n">all_datasets</span><span class="p">)</span>

    <span class="c1"># populate template to make webpage</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span>
        <span class="n">loader</span><span class="o">=</span><span class="n">FileSystemLoader</span><span class="p">(</span><span class="n">ROOT_DIR</span> <span class="o">/</span> <span class="s2">&quot;climind&quot;</span> <span class="o">/</span> <span class="s2">&quot;data_types&quot;</span> <span class="o">/</span> <span class="s2">&quot;jinja_templates&quot;</span><span class="p">),</span>
        <span class="n">autoescape</span><span class="o">=</span><span class="n">select_autoescape</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">template</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="s2">&quot;badc_boilerplate_multiple.jinja2&quot;</span><span class="p">)</span>

    <span class="n">monthly</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">TimeSeriesMonthly</span><span class="p">)</span>
    <span class="n">annual</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">TimeSeriesAnnual</span><span class="p">)</span>
    <span class="n">irregular</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">TimeSeriesIrregular</span><span class="p">)</span>

    <span class="n">rendered</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span>
        <span class="n">now</span><span class="o">=</span><span class="n">now</span><span class="p">,</span> <span class="n">climind_version</span><span class="o">=</span><span class="n">climind_version</span><span class="p">,</span> <span class="n">time_units</span><span class="o">=</span><span class="n">time_units</span><span class="p">,</span>
        <span class="n">datasets</span><span class="o">=</span><span class="n">all_datasets</span><span class="p">,</span>
        <span class="n">monthly</span><span class="o">=</span><span class="n">monthly</span><span class="p">,</span>
        <span class="n">annual</span><span class="o">=</span><span class="n">annual</span><span class="p">,</span>
        <span class="n">irregular</span><span class="o">=</span><span class="n">irregular</span>
    <span class="p">)</span>

    <span class="c1"># Next set up columns to write from the combined dataframe</span>
    <span class="n">n_data_columns</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_datasets</span><span class="p">)</span>
    <span class="n">columns_to_write</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">monthly</span><span class="p">:</span>
        <span class="n">columns_to_write</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">irregular</span><span class="p">:</span>
        <span class="n">columns_to_write</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_data_columns</span><span class="p">):</span>
        <span class="n">columns_to_write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_datasets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>

    <span class="c1"># Now write everything to the file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">rendered</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">common_datasets</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                       <span class="n">lineterminator</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                                       <span class="n">float_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.4f</span><span class="s1">&#39;</span><span class="p">,</span>
                                       <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                       <span class="n">columns</span><span class="o">=</span><span class="n">columns_to_write</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;end data</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="AveragesCollection">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.AveragesCollection">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">AveragesCollection</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple class to perform specific tasks on lists of :class:`.TimeSeriesAnnual`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">all_datasets</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">averages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdevs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plus_unc_lower</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minus_unc_lower</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plus_unc_upper</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minus_unc_upper</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">expand</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widest</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">all_datasets</span><span class="p">:</span>
            <span class="n">first_year</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">get_first_and_last_year</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">first_year</span> <span class="o">==</span> <span class="mi">1850</span><span class="p">:</span>
                <span class="n">pre_average</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">running_mean</span><span class="p">(</span><span class="mi">51</span><span class="p">)</span>
                <span class="n">pre_stdev</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">running_stdev</span><span class="p">(</span><span class="mi">51</span><span class="p">)</span>

                <span class="n">pre_average</span> <span class="o">=</span> <span class="n">pre_average</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="mi">50</span><span class="p">]</span>
                <span class="n">pre_stdev</span> <span class="o">=</span> <span class="n">pre_stdev</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="mi">50</span><span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">averages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pre_average</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stdevs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pre_stdev</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">plus_unc_lower</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pre_average</span> <span class="o">+</span> <span class="mf">1.645</span> <span class="o">*</span> <span class="n">pre_stdev</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">51.</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">minus_unc_lower</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pre_average</span> <span class="o">-</span> <span class="mf">1.645</span> <span class="o">*</span> <span class="n">pre_stdev</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">51.</span><span class="p">))</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">plus_unc_upper</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pre_average</span> <span class="o">+</span> <span class="mf">1.645</span> <span class="o">*</span> <span class="n">pre_stdev</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">minus_unc_upper</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pre_average</span> <span class="o">-</span> <span class="mf">1.645</span> <span class="o">*</span> <span class="n">pre_stdev</span><span class="p">)</span>

<div class="viewcode-block" id="AveragesCollection.count">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.AveragesCollection.count">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">averages</span><span class="p">)</span></div>


<div class="viewcode-block" id="AveragesCollection.best_estimate">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.AveragesCollection.best_estimate">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">best_estimate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">averages</span><span class="p">)</span></div>


<div class="viewcode-block" id="AveragesCollection.range">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.AveragesCollection.range">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">widest</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plus_unc_upper</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minus_unc_upper</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plus_unc_lower</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minus_unc_lower</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">averages</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">averages</span><span class="p">)</span></div>


<div class="viewcode-block" id="AveragesCollection.lower_range">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.AveragesCollection.lower_range">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">lower_range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">widest</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minus_unc_upper</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minus_unc_lower</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">averages</span><span class="p">)</span></div>


<div class="viewcode-block" id="AveragesCollection.upper_range">
<a class="viewcode-back" href="../../../climind.data_types.html#climind.data_types.timeseries.AveragesCollection.upper_range">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">upper_range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">widest</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plus_unc_upper</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plus_unc_lower</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">averages</span><span class="p">)</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, John Kennedy.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>